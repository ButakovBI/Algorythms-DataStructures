## Описание

Проект представляет собой калькулятор, который генерирует конфигурацию для сервисов на основе входных параметров. Калькулятор принимает на вход JSON-файл. JSON используется для ввода и вывода, потому что это универсальный, читаемый и легко редактируемый формат, который упрощает интеграцию с другими системами и удобно подходит для хранения сложных конфигураций сервисов.

Для данного калькулятора конфигурации оптимальным форматом поставки будет модульный Python-пакет, который включает классы для отдельных сервисов, модуль для калькулятора и вспомогательные функции. В таком формате сервис удобно интегрировать в более крупные системы или использовать как самостоятельное решение.

### Почему выбран модульный Python-пакет? Почему Python-пакет удобен для использования внутри продуктов Лаборатории Касперского?

1. **Гибкость интеграции**:
   - Модульный пакет позволяет гибко импортировать и использовать только необходимые части системы
   - Структура пакета облегчает его использование внутри CI/CD пайплайнов и автоматизацию.

2. **Легкость обновления и расширения**:
   - Модульный подход позволяет изменять или обновлять конкретные сервисы, не затрагивая остальной код, что удобно для постоянной поддержки и развития проекта. Соответствие принципу Open/Closed.

3. **Повторное использование кода**:
   - Быстрое подключение к новым системам Лаборатории Касперского
   - Конкретные сервисы или вспомогательные функции можно легко импортировать в другие модули проектов/системы.

4. **Возможность расширенной настройки и тестирования**:
   - Пакет упрощает тестирование, внесение изменений и обеспечение качества
   - Модульный пакет легко документировать и сопровождать.

5. **Готовность к масштабированию**:
   - Модульный пакет предоставляет готовую структуру для добавления новых функций или сервисов. Он может расширяться с минимальными изменениями, так как для добавления нового сервиса требуется только создать новый класс, реализовать его логику и зарегистрировать его в калькуляторе.


## Структура проекта

task2/
├── src/                                # Основная директория с исходным кодом проекта   
│   ├── services/                       # Папка, содержащая классы для сервисов  
│   │   ├── base.py                     # Определяет абстрактный базовый класс `ServiceBase` для всех сервисов  
│   │   ├── clickhouse.py               # Содержит класс сервиса `Clickhouse`   
│   │   ├── database_server.py          # Содержит класс сервиса `Database_Server`   
│   │   ├── elasticsearch.py            # Содержит класс сервиса `ElasticSearch`  
│   │   ├── kafka.py                    # Содержит класс сервиса `Kafka`    
│   │   ├── processor.py                # Содержит класс сервиса `Processor`   
│   │   ├── scanner.py                  # Содержит класс сервиса `Scanner`     
│   │   ├── server.py                   # Содержит класс сервиса `Server`    
│   │   ├── synchronizer.py             # Содержит класс сервиса `Synchronizer`  
│   │   ├── __init__.py                 # Инициализация пакета services     
│   │    
│   ├── calculator.py                   # Главный модуль с классом `Calculator`   
│   ├── config.json                     # JSON-файл - входные данные    
│   ├── helpers.py                      # Вспомогательные функции     
│   ├── main.py                         # Основной файл запуска программы      
│       
├── tests/                              # Директория с тестами для всех модулей проекта     
│   ├── test_calculator/                # Поддиректория с тестами для модуля Calculator    
│   │   ├── conftest.py                 # Фикстуры и доп. классы для тестов     
│   │   ├── test_calculator.py          # Тесты для `Calculator`    
|   |      
│   ├── test_round_up.py                # Тесты для функции `round_up` из helpers.py     
│   ├── test_service_base.py            # Тесты для базового класса `ServiceBase`    
│   ├── test_service_clickhouse.py      # Тесты для `Clickhouse`       
│   ├── test_service_database_server.py # Тесты для `Database_Server`      
│   ├── test_service_elasticsearch.py   # Тесты для `ElasticSearch`    
│   ├── test_service_kafka.py           # Тесты для `Kafka`       
│   ├── test_service_processor.py       # Тесты для `Processor`      
│   ├── test_service_scanner.py         # Тесты для `Scanner`     
│   ├── test_service_server.py          # Тесты для `Server`   
│   ├── test_service_synchronizer.py    # Тесты для `Synchronizer`     
│    
├── Makefile                            # Файл для автоматизации задач    
├── pyproject.toml                      # Конфигурационный файл для настройки зависимостей и параметров проекта    
├── README.md                           # Документация и описание проекта   




## Запуск

## Управление проектом с помощью Makefile

`Makefile` в данном проекте предоставляет команды для управления проектом, включая запуск тестов, проверку стиля кода, генерацию отчетов о покрытии и запуск основной программы с конфигурационным файлом. Это упрощает работу с проектом и автоматизирует часто выполняемые задачи.

### Основные команды Makefile

1. **Запуск основной программы**

   ```bash
   make run CONFIG_FILE=<path_to_config_file>
   ```

   - Запускает программу с указанным JSON-файлом конфигурации, например `config.json`. Если `CONFIG_FILE` не указан, команда не выполнится.
   - Выводит итоговую конфигурацию в файл `output_config.json`.

`path/to/config.json` — это путь к JSON-файлу, содержащему начальные настройки сервисов. Пример формата файла `config.json`:

```json
{
    "service1": {},
    "service2": {},
    "service3": {},
    "serviceN": {}
}
```

После запуска итоговая конфигурация всех сервисов будет выведена в файл в формате JSON.

Пример вывода:

```json
{
    "kafka": {
        "replicas": 1,
        "memory": 100,
        "cpu": 1.47,
        "storage": 0.384
    },
    "elasticsearch": {
        "replicas": 1,
        "memory": 0,
        "cpu": 3,
        "storage": 0.512
    },
    ...
}
```

2. **Запуск тестов с покрытием кода**

   ```bash
   make test
   ```

   - Запускает все тесты с помощью `pytest` и создает отчет о покрытии.
   - Достигнуто 95-100% покрытия каждого модуля.

3. **Проверка стиля кода и автоформатирование**

   ```bash
   make style
   ```

   - Проверяет стиль кода с помощью `flake8` и автоматически форматирует код с помощью `autopep8`.
   - Обеспечивает единый стиль кода, что облегчает его чтение и сопровождение.

4. **Генерация HTML-отчета по покрытию кода**

   ```bash
   make coverage
   ```

   - Создает HTML-отчет по покрытию кода, который сохраняется в директории `htmlcov`.
   - Можно открыть файл `htmlcov/index.html` в браузере для визуального анализа покрытия кода.


6. **Очистка временных файлов**

   ```bash
   make clean
   ```

   - Удаляет временные файлы, папки `__pycache__`, файлы покрытия и выходной файл `output_config.json`.

7. **Вывод справочной информации**

   ```bash
   make help
   ```

   - Выводит список доступных команд с кратким описанием каждой.

Эти команды упрощают управление проектом и автоматизируют ключевые задачи, такие как тестирование, форматирование и запуск программы с конфигурационными файлами.


## Основные классы и файлы

### 1. `calculator.py`

Класс `Calculator` управляет сервисами, регистрирует их и обновляет конфигурации на основе входных параметров. 

**Основные методы:**
- `register_services` — регистрация сервисов на основе переданного словаря с сервисами.
- `update_all_configs` — обновление конфигураций всех зарегистрированных сервисов на основе параметров.
- `get_all_configs` — получение текущей конфигурации всех сервисов в виде словаря.

### 2. `services/base.py`

Базовый класс `ServiceBase` является абстрактным и определяет интерфейс для всех сервисов. Он включает методы `update_config` (обновление конфигурации) и `get_config` (получение текущей конфигурации).

### 3. `services/service_name.py`

Содержит классы конкретных сервисов, таких как `Kafka`, `ElasticSearch`, `Processor`, `Server`, `Database_Server`, `Clickhouse`, `Synchronizer`, и `Scanner`. Каждый из этих классов наследует `ServiceBase` и реализует метод `update_config` для настройки конкретных параметров в зависимости от входных данных.

### 4. `helpers.py`

Модуль содержит вспомогательную функцию `round_up` для округления значений вверх с заданной точностью.

### 5. `main.py`

Главный файл, который:
1. Загружает конфигурацию из файла `config.json`.
2. Создает объект `Calculator`, регистрирует сервисы и передает параметры.
3. Выводит итоговую конфигурацию всех сервисов в формате JSON.

