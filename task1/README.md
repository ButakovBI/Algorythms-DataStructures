## Структура файлов

task1/
├── migrations/                  # Каталог для управления миграциями базы данных
│   ├── versions/                # Каталог версий миграций
│   ├── env.py                   # Конфигурационный файл миграций
│
├── src/                         # Каталог с основным исходным кодом приложения
│   ├── parser/                 
│   │   ├── data_classes.py     
│   │   ├── db_models.py         # Определение моделей базы данных для ORM
│   │   ├── db_operations.py     # Операции добавления, удаления, обновления тегов, логи
│   │   ├── parse_from_table.py  # Доп. задание №1 - парсер таблицы правил из html-таблицы
│   │   ├── rule_index.py        # Индекс для быстрого поиска правил
│   │   ├── tag_processor.py     # Основная логика обработки тегов - здесь находится функция "apply_tag_rules"
│   │   │                          Здесь же находится и реализация доп. задания с отложенным удалением
│   │   └── utils.py             # Вспомогательные функции
│   ├── config.py                # Конфигурационный файл для получения переменных из .env
│   ├── database.py              # Настройка подключения к базе данных
│   └── main.py       
│          
├── tests/                       # Каталог с тестами
│   ├── conftest.py              # Файл конфигурации тестов - настройка тестовой базы данных
│   ├── test_db.py               # Тесты для операций с базой данных
│   ├── test_delayed_clean.py    # Тесты для дополнительного задания №2 - отложенного удаления
│   ├── test_parse_from_table.py # Тесты для дополнительного задания №1 - парсера таблицы правил
│   ├── test_rule_index.py       # Тесты для модуля rule_index.py
│   ├── test_tag_processor.py    # Тесты для модуля tag_processor.py
│   └── test_utils.py            # Тесты для вспомогательных функций
│
├── venv/                        # Виртуальное окружение проекта
├── .env                         # Файл с переменными окружения
├── alembic.ini                  # Конфигурация для Alembic (для миграций)
├── Makefile                     # Команды для автоматизации - запуск, проверка на стиль и прочее
├── pyproject.toml               # Конфигурационный файл для правильного запуска тестов
├── README.md                    # Основная документация проекта
├── requirements.txt             # Файл со списком зависимостей
└── task.md                      # Описание ТЗ


## Описание

Ресурс-архив представляет собой приложение для работы с тегами, где реализована обработка, нормализация и тестирование тегов, а также работа с базой данных и миграциями с использованием Alembic. 

Считаю обоснованным использование базы данных(PostgreSQL) в силу условия 2 из ТЗ: 
"2. Есть предопределенная таблица разрешенных тегов, она может изменяться при каждом запуска (удаляться записи, добавляться новые, изменяться существующие.)"
Реализовал также дополнительно добавление, удаление и обновление тегов, и логирование всех действий в отдельной таблице БД.

Также в моей реализации в функции apply_tag_rules в аргументах не находятся правила - они в БД для каждого тега и при запуске функции мы обращаемся в базу данных и далее выполняем все обработки.

Задание было реализовано полностью, включая дополнительные пункты.


## Настройка и запуск

### Запуск миграций

Чтобы создать таблицы в базе данных, выполните миграции Alembic:

```bash
alembic upgrade head
```

## Установка и запуск

### Установка зависимостей

Сначала необходимо установить зависимости из `requirements.txt`. Необходимо выполнить следующую команду:

```bash
make install_deps
```

Это запустит команду `pip install -r requirements.txt`, которая установит все необходимые библиотеки.

### Запуск тестов

Запуск всех тестов:

```bash
make test
```

Эта команда выполнит тесты с помощью `pytest` и создаст отчет о покрытии кода с помощью `coverage`. Итоговый отчет будет выведен в консоли.

### Проверка стиля кода

Запуск линтера:

```bash
make style
```

Команда автоматически применит форматирование к файлам в папках `src` и `tests`. `autopep8` для приведения их к стандарту PEP8.

### Отчет о покрытии в формате HTML

Cгенерировать HTML-отчет о покрытии:

```bash
make coverage
```

После выполнения команды отчет будет доступен в папке `htmlcov`. В файле `htmlcov/index.html` - подробный отчет.

### Очистка файлов

Для очистки временных файлов:

```bash
make clean
```

Эта команда удалит все папки `__pycache__`, файл `.coverage` и папку `htmlcov`.

### Выполнение всех команд

Для выполнения всех вышеуказанных команд последовательно (установка зависимостей, проверка стиля, запуск тестов и генерация отчета о покрытии), выполните:

```bash
make all
```

---

Эти инструкции установят зависимости, проверят качество кода и всё,  что описано выше.

Отчёт по покрытию кода будет сохранён в директории `htmlcov`.

## Использование

- Основная логика находится в `src/parser/tag_processor.py`.
- Настройки для баз данных и других параметров проекта можно изменить в `src/config.py`.
